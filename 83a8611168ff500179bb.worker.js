!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/eclipse/",n(n.s="//8thD6s")}({"//8thD6s":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n("rQ2ytSW3"),r=n("cMrItmY9"),s=self;s.addEventListener("message",({data:e})=>{e.type===r.SIMULATE_WORKER_SIMULATE&&function(e,t){try{const n=Date.now(),i=o.simulate(t);s.postMessage({id:e,type:r.SIMULATE_WORKER_RESULT,result:Object.assign({},i,{duration:Date.now()-n})})}catch(t){s.postMessage({type:r.SIMULATE_WORKER_ERROR,id:e,error:t})}}(e.id,e.state)})},"0VfMFh8Y":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n("Joo47Po4"),r=n("YzQktGzZ"),s=n("1IzBBJcF"),i=n("L2vGdZLu");t.distributeRolls=function*(e,t,n){const c=r.countMaxHits(e,t,n[n.length-1]),a=s.countMaxTargets(e[0],t,n),u=n.length-a;e:for(const r of o.generateRolls(c,a,!1)){const o=[];for(let s=0;s<c;s++){const c=r[s]+u-1;if(i.isMissed(e[s],t,n[c]))continue e;o.push(c)}yield o}}},"1IzBBJcF":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n("L2vGdZLu");t.countMaxTargets=function(e,t,n){const r=n.length;if(6===e)return r;for(let s=r-1;s>=0;s--)if(o.isMissed(e,t,n[s]))return r-s-1;return r}},"1WQvOlC7":function(e,t,n){"use strict";(function(e,n){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.error=0]="error",e[e.warn=1]="warn",e[e.info=2]="info",e[e.profile=3]="profile",e[e.debug=4]="debug",e[e.verbose=5]="verbose"}(o=t.ELogLevel||(t.ELogLevel={}));const r={[o.error]:"ERROR",[o.warn]:"WARN!",[o.info]:"INFO!",[o.profile]:"PROFL",[o.debug]:"DEBUG",[o.verbose]:"VERBS"},s=(void 0===e?n.logLevel:e.env.LOG_LEVEL)||o.error;function i(e,...t){s<e||console.log(r[e],...t)}t.log=i;const c={},a={},u={};t.logDuration=function(e,t){if(s<o.profile)return;const n=Date.now();if(!c[e])return void(c[e]=n);const r=n-c[e];r>1&&i(o.verbose,e,r),delete c[e],u[e]&&i(o.warn,"duration uuid collision",e),u[e]=!0,t&&(a[t]||(a[t]={duration:0,count:0}),a[t].duration+=r,a[t].count++)},t.showSummary=function(){s<o.profile||(i(o.profile,""),i(o.profile,"Summary:"),Object.keys(a).sort().forEach(e=>{a[e].avg=a[e].duration/a[e].count,i(o.profile,`${e}:`,a[e])}),Object.keys(a).forEach(e=>delete a[e]),Object.keys(c).forEach(e=>delete c[e]),Object.keys(u).forEach(e=>delete u[e]))}}).call(this,n("KCCgL81B"),n("yLpjYHve"))},"1bEoxOtW":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n("NiVzrYvK");t.permutationsCountGrouped=function(e){let t=1;for(const n of e)t*=o.permutationsCount(n);return t}},"8oKK0YV9":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n("NaLL1Y2m");t.shipWeights=new Map,t.shipWeights.set(o.EBattleShipType.interceptor,1),t.shipWeights.set(o.EBattleShipType.cruiser,2),t.shipWeights.set(o.EBattleShipType.dreadnought,3),t.shipWeights.set(o.EBattleShipType.starbase,4),t.shipWeights.set(o.EBattleShipType.deathmoon,5),t.BASE_SCORE=8,t.KILL_WEIGHT=10},"8vpkoTz8":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.rollsUngroup=function(e){const t=[];for(let n=0,o=e.length;n<o;n++)for(const o of e[n])t.push({roll:o,group:n});return t.sort((e,t)=>t.roll-e.roll),{rolls:t.map(e=>e.roll),map:t.map(e=>e.group)}}},BASmcPHv:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.weaponGroups=function(e){const t=[];for(const n of e)t[t.length-1]&&t[t.length-1][0].damage===n.damage?t[t.length-1].push(n):t.push([n]);return t}},"Fsg/bEYp":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n("1WQvOlC7"),r=n("gWRWWnmQ"),s=n("OtyT2BxY"),i=n("tEuR1qgf"),c=n("ye1mLLJj");t.simulateBattle=function(e){o.logDuration("SimulateBattle");const t={},n=i.initiativePhases(e),a=[],u=new Set,l=new Map;let f=[e],p=0;for(;f.length;){o.logDuration("SimulateBattleLayer:"+p,"SimulateBattleLayer");const e=[],i=[];for(const o of f){const r=c.simulateTurn(o,p,n,t),f=s.battleSceneHashAndHp(o).hp;if(a.push(...r.transitions),e.push(...r.scenes.filter(e=>{const t=s.battleSceneHash(e);return!l.has(t)&&(l.set(t,e),!e.winner)})),r.scenes.filter(({winner:e})=>e).forEach(e=>{const t=s.battleSceneHash(e),n=l.get(t);u.add(n)}),p>0)for(const e of r.transitions){const{hash:t,hp:n}=s.battleSceneHashAndHp(e.to),o=l.get(t);o!==e.to&&(e.to=o,n>f&&(i.push(e),e.posibleRing=!0))}else for(const e of r.transitions){const t=s.battleSceneHash(e.to),n=l.get(t);n!==e.to&&e.to.winner&&(e.to=n)}}o.logDuration("SimulateBattleRings:"+p,"SimulateBattleRings"),i.forEach(e=>r.removeRing(a,e)),o.logDuration("SimulateBattleRings:"+p,"SimulateBattleRings"),o.logDuration("SimulateBattleLayer:"+p,"SimulateBattleLayer"),f=e,p++}return o.logDuration("SimulateBattle"),o.showSummary(),{scenes:Array.from(u),transitions:a}}},Fvfmsiim:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.yellow=1]="yellow",e[e.orange=2]="orange",e[e.blue=3]="blue",e[e.red=4]="red",e[e.pink=5]="pink"}(t.EWeaponDamageType||(t.EWeaponDamageType={})),function(e){e[e.missile=0]="missile",e[e.gun=1]="gun"}(t.EWeaponType||(t.EWeaponType={})),t.riftDamage={1:{roll:1,damage:0},2:{roll:1,damage:0},3:{roll:1,damage:0,selfDamage:1},4:{roll:6,damage:1},5:{roll:6,damage:2},6:{roll:6,damage:3,selfDamage:1}}},GKRh4Zjz:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n("1WQvOlC7"),r=n("iWFFjoVs"),s=n("1bEoxOtW"),i=n("bpfAsEus"),c=n("lUDBR4oE"),a=n("WmOkEUJb"),u=n("Fvfmsiim"),l=n("OtyT2BxY"),f=n("1IzBBJcF"),p=n("evQQUgl4"),h=n("8vpkoTz8"),g=n("NE0dXASR"),d=n("BASmcPHv"),m=n("uj8C/1Pa");function y(e,t,n){return t[e]=n,n.map(e=>Object.assign({},e))}function b(e,t,n,o){return[...n.map(n=>f.countMaxTargets(n,t,e)),o].join(",")}t.simulatePhase=function(e,t,n,f={}){const v=(t.turn>0?"g":"m")+":"+l.battleSceneHash(e)+":"+l.battleSceneHash({ships:n,defender:""});if(f[v])return function(e,t,n){return o.log(o.ELogLevel.debug,"SimulatePhase","from cache",e),t[e].map(e=>Object.assign({},e,{from:n}))}(v,f,e);o.logDuration("SimulatePhase:"+v,"SimulatePhase");const w=function(e,t,n){const o=p.getWeapons(n,0===t.turn?u.EWeaponType.missile:u.EWeaponType.gun).sort((e,t)=>t.damage-e.damage);if(!o.length)return;const r=g.shipsByOwner(e.ships,n[0].owner,!0).filter(e=>e.hp>0).sort((e,t)=>t.defence-e.defence),s=r.map(({defence:e})=>e),c=n[0].attack,a=o.some(e=>e.damage===u.EWeaponDamageType.pink),l=d.weaponGroups(o),f=l.map(e=>e.length);return{targets:r,targetsDef:s,bonus:c,groups:l,groupSizes:f,totalCount:i.rollsCountGrouped(f,6,!1),hasRift:a}}(e,t,n);if(!w)return o.logDuration("SimulatePhase:"+v,"SimulatePhase"),y(v,f,[{from:e,to:m.cloneBattlescene(e),weight:1}]);const{targets:O,targetsDef:S,bonus:_,groups:M,groupSizes:j,totalCount:E,hasRift:T}=w,R=[];let W=0;const P={};for(const n of r.generateRollsGrouped(j)){const{rolls:o,map:r}=h.rollsUngroup(n),i=s.permutationsCountGrouped(n);let l,f=0;l=T?r.map((e,t)=>{const n=M[e][0];if(n.damage===u.EWeaponDamageType.pink){const e=u.riftDamage[o[t]];return o[t]=e.roll,f+=e.selfDamage||0,{type:u.EWeaponType.gun,damage:e.damage}}return n}):r.map(e=>M[e][0]);const p=b(S,_,o,f);if(P[p]){W+=i,P[p].weight+=i;continue}const g=f?a.riftSelfDamage(e,f,t.player):e;let d=c.calcAttack(g,t,o,l,_,O,S);if(!d){if(!f){R.push({from:e,to:m.cloneBattlescene(e),weight:E-W});break}d=g}W+=i;const y={from:e,to:d,weight:i};P[p]=y,R.push(y)}return o.logDuration("SimulatePhase:"+v,"SimulatePhase"),y(v,f,R)}},HJLh8pk2:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWinner=function(e){const t=Object.create(null);e.forEach(function({hp:e,owner:n}){t[n]||(t[n]=0),e>0&&t[n]++});const n=Object.keys(t);return!t[n[0]]&&t[n[1]]?n[1]:!t[n[1]]&&t[n[0]]?n[0]:!t[n[0]]&&!t[n[1]]||null}},Joo47Po4:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateRolls=function*e(t,n=6,o=!0){if(t<1)yield[];else for(let r=n;r>0;r--)if(1===t)yield[r];else for(const s of e(t-1,o?r:n,o))yield[r].concat(s)}},KCCgL81B:function(e,t){var n,o,r=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function c(e){if(n===setTimeout)return setTimeout(e,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(e){n=s}try{o="function"==typeof clearTimeout?clearTimeout:i}catch(e){o=i}}();var a,u=[],l=!1,f=-1;function p(){l&&a&&(l=!1,a.length?u=a.concat(u):f=-1,u.length&&h())}function h(){if(!l){var e=c(p);l=!0;for(var t=u.length;t;){for(a=u,u=[];++f<t;)a&&a[f].run();f=-1,t=u.length}a=null,l=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===i||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function d(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new g(e,t)),1!==u.length||l||c(h)},g.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=d,r.addListener=d,r.once=d,r.off=d,r.removeListener=d,r.removeAllListeners=d,r.emit=d,r.prependListener=d,r.prependOnceListener=d,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},L2vGdZLu:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isMissed=function(e,t,n){return 6!==e&&(1===e||e+t<6+n)}},LGXWZbb8:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.prepareWays=function(e){const t=new Map,n=new Map;for(const o of e)t.has(o.from)||t.set(o.from,[]),t.get(o.from).push(o),o.posibleRing||(n.has(o.to)||n.set(o.to,[]),n.get(o.to).push(o));return{wayDown:t,wayUp:n}}},NE0dXASR:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shipsByOwner=function(e,t,n=!1){return e.filter(function(e){return e.hp>0&&e.owner===t?!n:n})}},NaLL1Y2m:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.interceptor=0]="interceptor",e[e.cruiser=1]="cruiser",e[e.dreadnought=2]="dreadnought",e[e.starbase=3]="starbase",e[e.deathmoon=4]="deathmoon"}(t.EBattleShipType||(t.EBattleShipType={})),t.Battleship=class{constructor(e,t="player",n=[],o=1,r=0,s=0,i=0,c=0){this.type=e,this.owner=t,this.weapons=n,this.hp=o,this.initiative=r,this.defence=s,this.attack=i,this.heal=c,this.maxHp=this.hp}clone(){const e=new(0,Object.getPrototypeOf(this).constructor)(this.type,this.owner,this.weapons,this.hp,this.initiative,this.defence,this.attack,this.heal);return e.maxHp=this.maxHp,e}}},NiVzrYvK:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n("f0fmOpmr"),r=new Map;t.permutationsCount=function(e){const t=e.join(",");if(r.has(t))return r.get(t);const n=Object.create(null);for(const t of e)n[t]||(n[t]=0),n[t]++;let s=o.factorial(e.length);for(const e in n)s/=o.factorial(n[e]);return r.set(t,s),s}},OVXaxK96:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=new WeakMap;t.makeInvertWay=function(e){if(o.has(e))return o.get(e);const t=new Map;for(const n of e)for(const e of n)t.has(e.to)||t.set(e.to,[]),t.get(e.to).push(e);return o.set(e,t),t}},OtyT2BxY:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.battleSceneHash=function(e){return e.ships.map(e=>e.owner+e.type+e.hp).sort().join(",")},t.battleSceneHashAndHp=function(e){let t=0;const n=e.ships.map(e=>(t+=e.hp,e.owner+e.type+e.hp)).sort().join(",");return{hp:t,hash:n}}},QX2Yx3EJ:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n("sBDRxKrt"),r=n("T1L+ICuy");t.collapseGraph=function(e,t,n=!0){const s=new Set;e=r.normalizeGraph(e,t,n);for(const t of e[e.length-1])s.add(t.to);const i=Array.from(s);let c=0;const a={scenes:i,transitions:i.map(n=>{const r=o.getSceneWeightByLayers(e,n);return c+=r,{from:t,to:n,weight:r}})};if(Math.abs(c-1)>.001)for(const e of a.transitions)e.weight/=c;return a}},"T1L+ICuy":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n("OtyT2BxY"),r=n("gWRWWnmQ");t.normalizeGraph=function(e,t,n=!0){const s=[],i=o.battleSceneHash(t),c=[],a=[],u=e[e.length-1];for(const r of e){const e=new Map,l=[];s.push(l);for(const s of r)e.has(s.from)||e.set(s.from,[]),e.get(s.from).push(s),c.push(s),u===r&&n&&o.battleSceneHash(s.to)===i?(s.to=t,s.posibleRing=!0,a.push(s)):l.push(s);for(const[,t]of e){let e=0;for(const{weight:n}of t)e+=n;for(const n of t)n.weight/=e}}return a.forEach(e=>r.removeRing(c,e)),s}},TEMBL4QZ:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shipsByPhase=function(e,t){const n=[];for(const o of t){const t=e[o];t.hp>0&&n.push(t)}return n}},W0zosirX:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n("OtyT2BxY");t.simplifyGraph=function(e){const t=Object.create(null),n=Object.create(null);for(const r of e){const e=o.battleSceneHash(r.from),s=o.battleSceneHash(r.to),i=e+":"+s;if(n[i]){n[i].weight+=r.weight;continue}t[s]||(t[s]=r.to);const c=t[s];r.to===c?n[i]=r:n[i]={from:r.from,to:c,weight:r.weight}}return{transitions:Object.values(n),scenes:Object.values(t)}}},WmOkEUJb:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n("Fvfmsiim"),r=n("evQQUgl4"),s=n("uj8C/1Pa"),i=n("8oKK0YV9"),c=n("0VfMFh8Y");function a(e,t,n){const o=new Map,r=new Set,s=new Set;for(const i of e){const e=t[i];o.has(e)||o.set(e,0);const c=o.get(e)+1,a=n.get(e);if(c>a)return 0;o.set(e,c),c>=e.hp&&r.add(e),c===a&&s.add(e)}const c=r.size===t.length||s.size===t.length;let a=0;for(const[e,t]of o){if(e.hp<t&&!c)return 0;const n=e.hp<=t,o=i.shipWeights.get(e.type),r=Math.min(e.hp,t);a+=Math.pow(i.BASE_SCORE,o+(n?i.KILL_WEIGHT:0))*(n?1:r)}return a}t.riftSelfDamage=function(e,t,n){const i=s.cloneBattlescene(e);i.ships=i.ships.concat([]);const u=new Map;for(const t of e.ships){if(t.owner!==n)continue;const e=r.getWeapons([t],o.EWeaponType.gun);let s=0;for(const t of e)t.damage===o.EWeaponDamageType.pink&&s++;s&&u.set(t,s)}const l=[];for(let e=0;e<t;e++)l.push(6);const f=Array.from(u.keys()),p=new Map;let h,g=0;for(const e of c.distributeRolls(l,0,f.map(()=>0))){const t=a(e,f,u);0!==t&&(0===g||g>t)&&(g=t,h=e)}for(const e of h){const t=f[e];p.has(t)||p.set(t,t.clone()),p.get(t).hp--}for(const[e,t]of p)t.hp=Math.max(0,t.hp),i.ships.splice(i.ships.indexOf(e),1,t);return i}},YzQktGzZ:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n("L2vGdZLu");t.countMaxHits=function(e,t,n){for(let r=0;r<e.length;r++)if(o.isMissed(e[r],t,n))return r;return e.length}},ZhcdJAS1:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n("bQDjNfBW");function r(e,t){const n=Array.from(e.scenes).filter(([e])=>e.winner===t).map(s),o={};return n.forEach(e=>{const t=i(e);o[t]?o[t].probability+=e.probability:o[t]=e}),Object.values(o).sort((e,t)=>t.probability-e.probability)}function s([e,t]){const n=e.winner,o=e.ships.filter(e=>e.hp>0&&e.owner===n),r={};return o.forEach(e=>{r[e.type]=r[e.type]||0,r[e.type]++}),{probability:t,ships:Object.entries(r).map(([e,t])=>({type:parseInt(e,10),count:t})).sort((e,t)=>t.type-e.type)}}t.prepareSummary=function(e){const{results:t}=e;return{results:t,outcomes:{first:r(e,"first"),second:r(e,"second")}}};const i=o.memo(function(e){return e.ships.map(({type:e,count:t})=>e+":"+t).join(",")})},bQDjNfBW:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.memo=function(e){const t=new Map;return function(n){if(!t.has(n)){const o=e.call(this,n);t.set(n,o)}return t.get(n)}}},bpfAsEus:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n("nrirhvK+");t.rollsCountGrouped=function(e,t=6,n=!0){let r=1;for(const s of e)r*=o.rollsCount(s,t,n);return r}},cMrItmY9:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SIMULATE_WORKER_SIMULATE="simulate",t.SIMULATE_WORKER_RESULT="result",t.SIMULATE_WORKER_ERROR="error",t.SIMULATE_WORKER_ABORT="abort"},evQQUgl4:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWeapons=function(e,t){const n=[];return e.forEach(e=>{n.push(...e.weapons.filter(e=>e.type===t))}),n}},f0fmOpmr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n("bQDjNfBW");t.factorial=o.memo(function(e){return e<2?1:e*t.factorial(e-1)})},gWRWWnmQ:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n("1WQvOlC7"),r=n("OtyT2BxY"),s=n("LGXWZbb8");t.removeRing=function(e,t){const n=e.length+":"+r.battleSceneHash(t.from)+":"+r.battleSceneHash(t.to);o.logDuration(`RemoveRing:${n}`,"RemoveRing");const{wayUp:i,wayDown:c}=s.prepareWays(e),a=function(e,t,n){const o=new WeakMap;return function n(r){if(!e.has(r))return null;if(o.has(r)){const e=o.get(r);return e&&e.map(e=>e.slice())}const s=[];for(const o of e.get(r)){if(o.from===t){s.push([o]);continue}const e=n(o.from);e&&(e.forEach(e=>e.push(o)),s.push(...e))}const i=s.length?s:null;return o.set(r,i),i}(n)}(i,t.to,t.from);if(!a)return delete t.posibleRing,void o.logDuration(`RemoveRing:${n}`,"RemoveRing");e.splice(e.indexOf(t),1);const u=c.get(t.from);u.splice(u.indexOf(t),1);const l=[];for(const e of a){const n=new Map;let o=t.weight;for(const t of e.reverse())o*=t.weight,n.set(t,o);l.push(n)}for(const e of l)for(const[t,n]of e)t.weight-=n;for(const e of c.values()){let t=0;for(const n of e)t+=n.weight;for(const n of e)n.weight/=t}o.logDuration(`RemoveRing:${n}`,"RemoveRing")}},iWFFjoVs:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n("Joo47Po4");t.generateRollsGrouped=function*e(t,n=6,r=!0){if(0===t.length)return[];for(const s of o.generateRolls(t[0],n,r))if(t.length>1)for(const o of e(t.slice(1),n,r))yield[s].concat(o);else yield[s]}},lUDBR4oE:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n("1WQvOlC7"),r=n("OtyT2BxY"),s=n("uj8C/1Pa"),i=n("phtJuFcs"),c=n("0VfMFh8Y"),a={ancient:i.ancientTactics};t.calcAttack=function(e,t,n,i,u,l,f){const p=r.battleSceneHash(e)+":"+(t.turn>0?"g":"m")+":"+function(e,t){return n.map((e,n)=>e+"x"+t[n].damage).join(",")}(0,i)+":"+u+":"+r.battleSceneHash({ships:l,defender:""});o.logDuration("SimulateAttack:"+p,"SimulateAttack");const h=a.ancient;let g=0,d=null,m=0;for(const r of c.distributeRolls(n,u,f)){if(0===r.length)return o.logDuration("SimulateAttack:"+p,"SimulateAttack"),null;const n=r.map((e,t)=>({target:l[e],weapon:i[t]})),s=h(e,t,n);g<s&&(g=s,d=n),m++}o.log(o.ELogLevel.debug,"SimulateAttack:"+p,"distributions",m);const y=s.cloneBattlescene(e);y.ships=y.ships.concat([]);const b=new Map;for(const e of d){b.has(e.target)||b.set(e.target,e.target.clone());const t=b.get(e.target);t.hp-=e.weapon.damage,t.hp=Math.max(0,t.hp)}for(const[e,t]of b)y.ships.splice(y.ships.indexOf(e),1,t);return o.logDuration("SimulateAttack:"+p,"SimulateAttack"),y}},"nrirhvK+":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.rollsCount=function(e,t,n=!0){return n?function e(t,n){if(0===n||0===t)return 0;if(1===n)return t;if(1===t)return 1;const r=n-1,s=t-1;return o[r]||(o[r]=[]),o[r][s]||(o[r][s]=e(t-1,n)+e(t,n-1)),o[r][s]}(t,e):Math.pow(t,e)};const o=[]},phtJuFcs:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n("8oKK0YV9");t.ancientTactics=function(e,t,n){const r=new Map;n.forEach(e=>{r.has(e.target)?r.set(e.target,r.get(e.target)+e.weapon.damage):r.set(e.target,e.weapon.damage)});let s=0;for(const[e,t]of r){const n=e.hp<=t,r=o.shipWeights.get(e.type),i=Math.min(e.hp,t);s+=Math.pow(o.BASE_SCORE,r+(n?o.KILL_WEIGHT:0))*(n?1:i)}return s}},rQ2ytSW3:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n("z2CGlj4/"),r=n("Fsg/bEYp"),s=n("tyMsepCw"),i=n("ZhcdJAS1");t.simulate=function(e){const t=s.makeBattlescene(e),n=r.simulateBattle(t),c=o.battleSummary(n);return i.prepareSummary(c)}},sBDRxKrt:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n("OVXaxK96");function r(e,t){const n=e.get(t);if(!n||0===n.length)return 1;let o=0;for(const t of n)o+=t.weight*r(e,t.from);return o}t.getSceneWeightByLayers=function(e,t){return r(o.makeInvertWay(e),t)},t.getSceneWeightByGraphWay=r},tEuR1qgf:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initiativePhases=function(e){const t=Object.create(null);return e.ships.forEach(function(e,n){const o=e.owner+e.initiative+e.attack;t[o]||(t[o]=[]),t[o].push(n)}),Object.values(t).sort(function([t],[n]){const o=e.ships[t],r=e.ships[n];return o.initiative===r.initiative?o.owner===r.owner?0:o.owner===e.defender?-1:1:r.initiative-o.initiative})}},tyMsepCw:function(e,t,n){"use strict";var o=this&&this.__rest||function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&(n[o[r]]=e[o[r]])}return n};Object.defineProperty(t,"__esModule",{value:!0});const r=n("NaLL1Y2m");t.makeBattlescene=function(e){const t={ships:[],defender:e.players.defender};return["first","second"].forEach(function(n){e.players[n].ships.forEach(function(s){const i=e.ships.list[s],c=new r.Battleship(i.type,n,[],i.hp,i.initiative,i.defence,i.attack,i.heal);i.weapons.forEach(t=>{const n=e.weapons.list[t],{count:r}=n,s=o(n,["count"]);for(let e=0;e<r;e++)c.weapons.push(s)});for(let e=0;e<i.count;e++)t.ships.push(c.clone())})}),t}},"uj8C/1Pa":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cloneBattlescene=function(e){return{ships:e.ships,defender:e.defender,winner:e.winner}}},yLpjYHve:function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},ye1mLLJj:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n("1WQvOlC7"),r=n("QX2Yx3EJ"),s=n("W0zosirX"),i=n("OtyT2BxY"),c=n("HJLh8pk2"),a=n("tEuR1qgf"),u=n("TEMBL4QZ"),l=n("GKRh4Zjz");function f(e){for(const t of e){if(t.to.winner=c.getWinner(t.to.ships),t.to.winner)continue;let e=t.to.ships;for(let n=0,o=(e=t.to.ships=[].concat(e)).length;n<o;n++){let t=e[n];t.hp>0&&t.heal>0&&t.maxHp>t.hp&&(e[n]=t=t.clone(),t.hp=Math.min(t.hp+t.heal,t.maxHp))}}}t.simulateTurn=function(e,t,n,c={}){n||(n=a.initiativePhases(e));const p=t+":"+i.battleSceneHash(e);o.logDuration("SimulateTurn:"+p,"SimulateTurn");let h=[e];const g=[],d=n[n.length-1];for(const r of n){const n=[],i=h[0].ships[r[0]],a={player:i.owner,defender:e.defender===i.owner,initiative:i.initiative,turn:t};for(const e of h){const t=u.shipsByPhase(e.ships,r),o=l.simulatePhase(e,a,t,c);r===d&&f(o),n.push(...o)}o.logDuration("SimulateTurn:Simplify:"+p+":"+r,"SimulateTurn:Simplify");const m=s.simplifyGraph(n);o.logDuration("SimulateTurn:Simplify:"+p+":"+r,"SimulateTurn:Simplify"),h=m.scenes,g.push(m.transitions)}o.logDuration("SimulateTurn:Collapse:"+p,"SimulateTurn:Collapse");const m=r.collapseGraph(g,e,0!==t);return o.logDuration("SimulateTurn:Collapse:"+p,"SimulateTurn:Collapse"),o.logDuration("SimulateTurn:"+p,"SimulateTurn"),m}},"z2CGlj4/":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n("sBDRxKrt"),r=n("LGXWZbb8");t.battleSummary=function(e){const t=new Map,{wayUp:n}=r.prepareWays(e.transitions);for(const r of e.scenes)t.set(r,o.getSceneWeightByGraphWay(n,r));const s={};for(const[e,n]of t){const t=!0===e.winner?"none":e.winner;s[t]||(s[t]=0),s[t]+=n}return{scenes:t,results:s}}}});